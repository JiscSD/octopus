"use strict";function asyncGeneratorStep(e,t,r,n,o,s,a){try{var i=e[s](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var s=e.apply(t,r);function a(e){asyncGeneratorStep(s,n,o,a,i,"next",e)}function i(e){asyncGeneratorStep(s,n,o,a,i,"throw",e)}a(void 0)}))}}(()=>{if(!process.send)return!1;let e=new Set;if(process.env._seenhookpackages)try{e=new Set(JSON.parse(process.env._seenhookpackages))}catch(e){}setInterval((()=>{process.connected||(process.stdout.write("Sensor process disconnected (Terminating)"),process.exit())}),1e3).unref();const t=module.require,r=__filename,n="win32"===process.platform,o=(e,t={})=>{let o=!1;if(e.stack){const t=[],s=e.stack.split("\n");for(let e=1;e<s.length;e++){const a=s[e];if(a.includes(r))continue;if(a.includes("internal/")&&!a.includes("internal/modules/esm/translators"))continue;if(-1!==a.indexOf("file:///")||a.includes("internal/modules/esm/translators"))o=!0,t.push(a);else{let e=a.indexOf(" (");if(-1===e){const t=a.trim();if(n){if(":"!==t.charAt(4))continue}else if("/"!==t.charAt(3))continue;e=a.indexOf("at ")+1}if(e+=2,n){if(":"!==a.charAt(e+1))continue}else if("/"!==a.charAt(e))continue;o=!0,t.push(a)}}e.userStack=t,e.firstUserLineIndex=2}if(!o&&e.stack&&!0!==t.skipUserlandCheck)return!1;process.connected&&process.send(e)};let s=null;const a=(e,t,r)=>{if(!e)return!1;const n=e[t];if(!n)return!1;const o="AsyncFunction"===n.constructor.name;return e[t]=o?_asyncToGenerator((function*(...e){let t,o=null;try{throw new Error("SensorTrace")}catch(n){try{r.call(this,{args:e,stack:n.stack,getReturnValue:()=>t,returnPassthrough:e=>{o=e}})}catch(e){}}return t=n.call(this,...e),"function"==typeof o&&(t=o(t)),t})):function(...e){let t,o=null;try{throw new Error("SensorTrace")}catch(n){try{r.call(this,{args:e,stack:n.stack,getReturnValue:()=>t,returnPassthrough:e=>{o=e}})}catch(e){}}return t=n.call(this,...e),"function"==typeof o&&(t=o(t)),t},n},i={},c=(e,t)=>{i[e]=i[e]||[],i[e].push(t)},u=require("path"),l=require("fs"),d=u.join(__dirname,"hooks");l.readdirSync(d).forEach((r=>{if(!r.endsWith(".js"))return!1;const n=u.join(d,r),l=require(n),f=l.load,h=l.hook;if("function"!=typeof f)return process.stderr.write(`\nHook file at ${n} was not loaded. (Hook Handler (function) should be exported with exports.load)\n`),!1;if("string"!=typeof h)return process.stderr.write(`\nHook file at ${n} was not loaded. (Hook Name (string) should be exported with exports.hook)\n`),!1;const p={proxyMethod:(...e)=>a(...e),require:t,report:(e,t,r={})=>{if("sql"===h)(e=>{if(e.data&&e.data.sql){if(s===e.data.sql)return;s=e.data.sql}o(Object.assign({hook:"sql"},e))})({data:e,stack:t});else o({hook:h,data:e,stack:t},r)},reportInternal:(e,t)=>{p.report(e,t,{skipUserlandCheck:!0})},onEventEmitted:(e,t=(()=>{}))=>{c("core.events",(r=>{"emit"===r.data.method&&r.data.args[0]===e&&t(r)}))},onEventRegistered:(e,t=(()=>{}))=>{c("core.events",(r=>{"on"===r.data.method&&r.data.args[0]===e&&"function"==typeof r.data.args[1]&&t({context:r.data.context,handler:r.data.args[1]})}))},onBeforeRequire:(t,r=(()=>{}))=>{if(e.has(t))return void r({data:t});let n=!1;c("core.require",(e=>!n&&(t===e.data.id&&(n=!0,void r(e)))))},emitInternal:e=>{((e,t)=>{if(!i[e])return!1;i[e].forEach((e=>{e(t)}))})(h,{data:e})}};f(p)}))})();